#ifndef ICM20948_ICM20948_CONFIG_H
#define ICM20948_ICM20948_CONFIG_H

#include "icm20948_registers.h"
#include <stdbool.h>
#include <stddef.h>
#include <stdint.h>

#define ICM20948_REG_ADDRESS_BANK_SEL 0x7F
#define ICM20948_DEVICE_ID 0xEA
#define ICM20948_TEMP_SCALE 0

typedef float float32_t;

typedef struct {
    int16_t x;
    int16_t y;
    int16_t z;
} vec3_int16_t;

typedef struct {
    float32_t x;
    float32_t y;
    float32_t z;
} vec3_float32_t;

typedef enum {
    ICM20948_ERR_OK = 0,
    ICM20948_ERR_FAIL = 1 << 0,
    ICM20948_ERR_NULL = 1 << 1,
} icm20948_err_t;

typedef enum {
    ICM20948_DEV_ADDRESS_AD0_LOW = 0b1101000,
    ICM20948_DEV_ADDRESS_AD0_HIGH = 0b1101001,
} icm20948_dev_address_t;

typedef enum {
    ICM20948_REG_ADDRESS_WHO_AM_I = 0x00,
    ICM20948_REG_ADDRESS_LPF = 0x01,
    ICM20948_REG_ADDRESS_USER_CTRL = 0x03,
    ICM20948_REG_ADDRESS_LP_CONFIG = 0x05,
    ICM20948_REG_ADDRESS_PWR_MGMT_1 = 0x06,
    ICM20948_REG_ADDRESS_PWR_MGMT_2 = 0x07,
    ICM20948_REG_ADDRESS_INT_PIN_CFG = 0x0F,
    ICM20948_REG_ADDRESS_INT_ENABLE = 0x10,
    ICM20948_REG_ADDRESS_INT_ENABLE_1 = 0x11,
    ICM20948_REG_ADDRESS_INT_ENABLE_2 = 0x12,
    ICM20948_REG_ADDRESS_INT_ENABLE_3 = 0x13,
    ICM20948_REG_ADDRESS_I2C_MST_STATUS = 0x17,
    ICM20948_REG_ADDRESS_DMP_INT_STATUS = 0x18,
    ICM20948_REG_ADDRESS_INT_STATUS = 0x19,
    ICM20948_REG_ADDRESS_INT_STATUS_1 = 0x1A,
    ICM20948_REG_ADDRESS_INT_STATUS_2 = 0x1B,
    ICM20948_REG_ADDRESS_INT_STATUS_3 = 0x1C,
    ICM20948_REG_ADDRESS_SINGLE_FIFO_PRIORITY_SEL = 0x26,
    ICM20948_REG_ADDRESS_DELAY_TIMEH = 0x28,
    ICM20948_REG_ADDRESS_DELAY_TIMEL = 0x29,
    ICM20948_REG_ADDRESS_ACCEL_XOUT_H = 0x2D,
    ICM20948_REG_ADDRESS_ACCEL_XOUT_L = 0x2E,
    ICM20948_REG_ADDRESS_ACCEL_YOUT_H = 0x2F,
    ICM20948_REG_ADDRESS_ACCEL_YOUT_L = 0x30,
    ICM20948_REG_ADDRESS_ACCEL_ZOUT_H = 0x31,
    ICM20948_REG_ADDRESS_ACCEL_ZOUT_L = 0x32,
    ICM20948_REG_ADDRESS_GYRO_XOUT_H = 0x33,
    ICM20948_REG_ADDRESS_GYRO_XOUT_L = 0x34,
    ICM20948_REG_ADDRESS_GYRO_YOUT_H = 0x35,
    ICM20948_REG_ADDRESS_GYRO_YOUT_L = 0x36,
    ICM20948_REG_ADDRESS_GYRO_ZOUT_H = 0x37,
    ICM20948_REG_ADDRESS_GYRO_ZOUT_L = 0x38,
    ICM20948_REG_ADDRESS_TEMP_OUT_H = 0x39,
    ICM20948_REG_ADDRESS_TEMP_OUT_L = 0x3A,
    ICM20948_REG_ADDRESS_EXT_SLV_SENS_DATA_00 = 0x3B,
    ICM20948_REG_ADDRESS_EXT_SLV_SENS_DATA_01 = 0x3C,
    ICM20948_REG_ADDRESS_EXT_SLV_SENS_DATA_02 = 0x3D,
    ICM20948_REG_ADDRESS_EXT_SLV_SENS_DATA_03 = 0x3E,
    ICM20948_REG_ADDRESS_EXT_SLV_SENS_DATA_04 = 0x3F,
    ICM20948_REG_ADDRESS_EXT_SLV_SENS_DATA_05 = 0x40,
    ICM20948_REG_ADDRESS_EXT_SLV_SENS_DATA_06 = 0x41,
    ICM20948_REG_ADDRESS_EXT_SLV_SENS_DATA_07 = 0x42,
    ICM20948_REG_ADDRESS_EXT_SLV_SENS_DATA_08 = 0x43,
    ICM20948_REG_ADDRESS_EXT_SLV_SENS_DATA_09 = 0x44,
    ICM20948_REG_ADDRESS_EXT_SLV_SENS_DATA_10 = 0x45,
    ICM20948_REG_ADDRESS_EXT_SLV_SENS_DATA_11 = 0x46,
    ICM20948_REG_ADDRESS_EXT_SLV_SENS_DATA_12 = 0x47,
    ICM20948_REG_ADDRESS_EXT_SLV_SENS_DATA_13 = 0x48,
    ICM20948_REG_ADDRESS_EXT_SLV_SENS_DATA_14 = 0x49,
    ICM20948_REG_ADDRESS_EXT_SLV_SENS_DATA_15 = 0x4A,
    ICM20948_REG_ADDRESS_EXT_SLV_SENS_DATA_16 = 0x4B,
    ICM20948_REG_ADDRESS_EXT_SLV_SENS_DATA_17 = 0x4C,
    ICM20948_REG_ADDRESS_EXT_SLV_SENS_DATA_18 = 0x4D,
    ICM20948_REG_ADDRESS_EXT_SLV_SENS_DATA_19 = 0x4E,
    ICM20948_REG_ADDRESS_EXT_SLV_SENS_DATA_20 = 0x4F,
    ICM20948_REG_ADDRESS_EXT_SLV_SENS_DATA_21 = 0x50,
    ICM20948_REG_ADDRESS_EXT_SLV_SENS_DATA_22 = 0x51,
    ICM20948_REG_ADDRESS_EXT_SLV_SENS_DATA_23 = 0x52,
    ICM20948_REG_ADDRESS_FIFO_EN_1 = 0x66,
    ICM20948_REG_ADDRESS_FIFO_EN_2 = 0x67,
    ICM20948_REG_ADDRESS_FIFO_RST = 0x68,
    ICM20948_REG_ADDRESS_FIFO_MODE = 0x69,
    ICM20948_REG_ADDRESS_FIFO_COUNTH = 0x70,
    ICM20948_REG_ADDRESS_FIFO_COUNTL = 0x71,
    ICM20948_REG_ADDRESS_FIFO_R_W = 0x72,
    ICM20948_REG_ADDRESS_DATA_RDY_STATUS = 0x74,
    ICM20948_REG_ADDRESS_FIFO_CFG = 0x76,
    ICM20948_REG_ADDRESS_MEM_START_ADDR = 0x7C,
    ICM20948_REG_ADDRESS_MEM_BANK_SEL = 0x7E,
    ICM20948_REG_ADDRESS_SELF_TEST_X_GYRO = 0x02,
    ICM20948_REG_ADDRESS_SELF_TEST_Y_GYRO = 0x03,
    ICM20948_REG_ADDRESS_SELF_TEST_Z_GYRO = 0x04,
    ICM20948_REG_ADDRESS_SELF_TEST_X_ACCEL = 0x0E,
    ICM20948_REG_ADDRESS_SELF_TEST_Y_ACCEL = 0x0F,
    ICM20948_REG_ADDRESS_SELF_TEST_Z_ACCEL = 0x10,
    ICM20948_REG_ADDRESS_XA_OFFS_H = 0x14,
    ICM20948_REG_ADDRESS_XA_OFFS_L = 0x15,
    ICM20948_REG_ADDRESS_YA_OFFS_H = 0x17,
    ICM20948_REG_ADDRESS_YA_OFFS_L = 0x18,
    ICM20948_REG_ADDRESS_ZA_OFFS_H = 0x1A,
    ICM20948_REG_ADDRESS_ZA_OFFS_L = 0x1B,
    ICM20948_REG_ADDRESS_TBC_PLL = 0x28,
    ICM20948_REG_ADDRESS_GYRO_SMPLRT_DIV = 0x00,
    ICM20948_REG_ADDRESS_GYRO_CONFIG_1 = 0x01,
    ICM20948_REG_ADDRESS_GYRO_CONFIG_2 = 0x02,
    ICM20948_REG_ADDRESS_XG_OFFS_USRH = 0x03,
    ICM20948_REG_ADDRESS_XG_OFFS_USRL = 0x04,
    ICM20948_REG_ADDRESS_YG_OFFS_USRH = 0x05,
    ICM20948_REG_ADDRESS_YG_OFFS_USRL = 0x06,
    ICM20948_REG_ADDRESS_ZG_OFFS_USRH = 0x07,
    ICM20948_REG_ADDRESS_ZG_OFFS_USRL = 0x08,
    ICM20948_REG_ADDRESS_ODR_ALIGN_EN = 0x09,
    ICM20948_REG_ADDRESS_ACCEL_SMPLRT_DIV_1 = 0x10,
    ICM20948_REG_ADDRESS_ACCEL_SMPLRT_DIV_2 = 0x11,
    ICM20948_REG_ADDRESS_ACCEL_INTEL_CTRL = 0x12,
    ICM20948_REG_ADDRESS_ACCEL_WOM_THR = 0x13,
    ICM20948_REG_ADDRESS_ACCEL_CONFIG_1 = 0x14,
    ICM20948_REG_ADDRESS_ACCEL_CONFIG_2 = 0x15,
    ICM20948_REG_ADDRESS_FSYNC_CONFIG = 0x52,
    ICM20948_REG_ADDRESS_TEMP_CONFIG = 0x53,
    ICM20948_REG_ADDRESS_MOD_CTRL_USR = 0x54,
    ICM20948_REG_ADDRESS_I2C_MST_ODR_CONFIG = 0x00,
    ICM20948_REG_ADDRESS_I2C_MST_CTRL = 0x01,
    ICM20948_REG_ADDRESS_I2C_MST_DELAY_CTRL = 0x02,
    ICM20948_REG_ADDRESS_I2C_SLV0_ADDR = 0x03,
    ICM20948_REG_ADDRESS_I2C_SLV0_REG = 0x04,
    ICM20948_REG_ADDRESS_I2C_SLV0_CTRL = 0x05,
    ICM20948_REG_ADDRESS_I2C_SLV0_DO = 0x06,
    ICM20948_REG_ADDRESS_I2C_SLV1_ADDR = 0x07,
    ICM20948_REG_ADDRESS_I2C_SLV1_REG = 0x08,
    ICM20948_REG_ADDRESS_I2C_SLV1_CTRL = 0x09,
    ICM20948_REG_ADDRESS_I2C_SLV1_DO = 0x0A,
    ICM20948_REG_ADDRESS_I2C_SLV2_ADDR = 0x0B,
    ICM20948_REG_ADDRESS_I2C_SLV2_REG = 0x0C,
    ICM20948_REG_ADDRESS_I2C_SLV2_CTRL = 0x0D,
    ICM20948_REG_ADDRESS_I2C_SLV2_DO = 0x0E,
    ICM20948_REG_ADDRESS_I2C_SLV3_ADDR = 0x0F,
    ICM20948_REG_ADDRESS_I2C_SLV3_REG = 0x10,
    ICM20948_REG_ADDRESS_I2C_SLV3_CTRL = 0x11,
    ICM20948_REG_ADDRESS_I2C_SLV3_DO = 0x12,
    ICM20948_REG_ADDRESS_I2C_SLV4_ADDR = 0x13,
    ICM20948_REG_ADDRESS_I2C_SLV4_REG = 0x14,
    ICM20948_REG_ADDRESS_I2C_SLV4_CTRL = 0x15,
    ICM20948_REG_ADDRESS_I2C_SLV4_DO = 0x16,
    ICM20948_REG_ADDRESS_I2C_SLV4_DI = 0x17,
} icm20948_reg_address_t;

typedef enum {
    ICM20948_BANK_0 = 0x00,
    ICM20948_BANK_1 = 0x01,
    ICM20948_BANK_2 = 0x02,
    ICM20948_BANK_3 = 0x03,
} icm20948_bank_t;

typedef enum {
    ICM20948_ACCEL_RANGE_2G = 0b00,
    ICM20948_ACCEL_RANGE_4G = 0b01,
    ICM20948_ACCEL_RANGE_8G = 0b10,
    ICM20948_ACCEL_RANGE_16G = 0b11,
} icm20948_accel_range_t;

typedef enum {
    ICM20948_GYRO_RANGE_250DPS = 0b00,
    ICM20948_GYRO_RANGE_500DPS = 0b01,
    ICM20948_GYRO_RANGE_1000DPS = 0b10,
    ICM20948_GYRO_RANGE_2000DPS = 0b11,
} icm20948_gyro_range_t;

typedef enum {
    ICM20948_MODE_SLEEP,
    ICM20948_MODE_LOW_POWER_ACC,
    ICM20948_MODE_LOW_NOISE_ACC,
    ICM20948_MODE_GYRO,
    ICM20948_MODE_MAG,
    ICM20948_MODE_ACCEL_GYRO,
    ICM20948_MODE_ACCEL_MAG,
    ICM20948_MODE_ACCEL_GYRO_MAG,
} icm20948_mode_t;

typedef enum {
    ICM20948_CLOCK_SOURCE_INTERNAL_20MHZ = 0b00,
    ICM20948_CLOCK_SOURCE_AUTO_SELECT = 0b01,
    ICM20948_CLOCK_SOURCE_RESET = 0b111,
} icm20948_clock_source_t;

typedef enum {
    ICM20948_FIFO_MODE_STREAM = 0x00,
    ICM20948_FIFO_MODE_SNAPSHOT = 0x01,
} icm20948_fifo_mode_t;

typedef enum {
    ICM20948_GYRO_DLPF_BW_197 = 0x00,
    ICM20948_GYRO_DLPF_BW_152 = 0x01,
    ICM20948_GYRO_DLPF_BW_120 = 0x02,
    ICM20948_GYRO_DLPF_BW_51 = 0x03,
    ICM20948_GYRO_DLPF_BW_24 = 0x04,
    ICM20948_GYRO_DLPF_BW_12 = 0x05,
    ICM20948_GYRO_DLPF_BW_6 = 0x06,
    ICM20948_GYRO_DLPF_BW_361 = 0x07,
} icm20948_gyro_dlpf_t;

typedef enum {
    ICM20948_GYRO_FIR_BW_774 = 0x00,
    ICM20948_GYRO_FIR_BW_470 = 0x01,
    ICM20948_GYRO_FIR_BW_258 = 0x02,
    ICM20948_GYRO_FIR_BW_135 = 0x03,
    ICM20948_GYRO_FIR_BW_69 = 0x04,
    ICM20948_GYRO_FIR_BW_35 = 0x05,
    ICM20948_GYRO_FIR_BW_18 = 0x06,
    ICM20948_GYRO_FIR_BW_9 = 0x07,
} icm20948_gyro_fir_t;

typedef enum {
    ICM20948_ACCEL_DLPF_BW_265 = 0x00,
    ICM20948_ACCEL_DLPF_BW_136 = 0x02,
    ICM20948_ACCEL_DLPF_BW_69 = 0x03,
    ICM20948_ACCEL_DLPF_BW_34 = 0x04,
    ICM20948_ACCEL_DLPF_BW_17 = 0x05,
    ICM20948_ACCEL_DLPF_BW_8 = 0x06,
    ICM20948_ACCEL_DLPF_BW_499 = 0x07,
} icm20948_accel_dlpf_t;

typedef enum {
    ICM20948_ACCEL_FIR_BW_1238 = 0x00,
    ICM20948_ACCEL_FIR_BW_497 = 0x00,
    ICM20948_ACCEL_FIR_BW_265 = 0x01,
    ICM20948_ACCEL_FIR_BW_137 = 0x02,
    ICM20948_ACCEL_FIR_BW_69 = 0x03,
} icm20948_accel_fir_t;

typedef enum {
    ICM20948_TEMP_DLPF_BW_7392 = 0x00,
    ICM20948_TEMP_DLPF_BW_218 = 0x01,
    ICM20948_TEMP_DLPF_BW_126 = 0x02,
    ICM20948_TEMP_DLPF_BW_66 = 0x03,
    ICM20948_TEMP_DLPF_BW_34 = 0x04,
    ICM20948_TEMP_DLPF_BW_17 = 0x05,
    ICM20948_TEMP_DLPF_BW_9 = 0x06,
} icm20948_temp_dlpf_t;

typedef enum {
    ICM20948_EXT_SYNC_DISABLED = 0x0,
    ICM20948_EXT_SYNC_TEMP_OUT_L = 0x1,
    ICM20948_EXT_SYNC_GYRO_XOUT_L = 0x2,
    ICM20948_EXT_SYNC_GYRO_YOUT_L = 0x3,
    ICM20948_EXT_SYNC_GYRO_ZOUT_L = 0x4,
    ICM20948_EXT_SYNC_ACCEL_XOUT_L = 0x5,
    ICM20948_EXT_SYNC_ACCEL_YOUT_L = 0x6,
    ICM20948_EXT_SYNC_ACCEL_ZOUT_L = 0x7,
} icm20948_ext_sync_t;

typedef enum {
    ICM20948_SLAVE_NUM_1 = 1,
    ICM20948_SLAVE_NUM_2 = 2,
    ICM20948_SLAVE_NUM_3 = 3,
} icm20948_slave_num_t;

typedef enum {
    ICM20948_INT_MODE_ACTIVEHIGH = 0x00,
    ICM20948_INT_MODE_ACTIVELOW = 0x01,
} icm20948_int_mode_t;

typedef enum {
    ICM20948_INT_DRIVE_PUSHPULL = 0x00,
    ICM20948_INT_DRIVE_OPENDRAIN = 0x01,
} icm20948_int_drive_t;

typedef enum {
    ICM20948_INT_LATCH_PULSE50US = 0x00,
    ICM20948_INT_LATCH_WAITCLEAR = 0x01,
} icm20948_int_latch_t;

typedef enum {
    ICM20948_INT_CLEAR_STATUSREAD = 0x00,
    ICM20948_INT_CLEAR_ANYREAD = 0x01,
} icm20948_int_clear_t;

typedef struct {
    float32_t accel_scale;
    float32_t gyro_scale;
} icm20948_config_t;

typedef struct {
    void* bus_user;
    icm20948_err_t (*bus_initialize)(void*);
    icm20948_err_t (*bus_deinitialize)(void*);
    icm20948_err_t (*bus_write_data)(void*, uint8_t, uint8_t const*, size_t);
    icm20948_err_t (*bus_read_data)(void*, uint8_t, uint8_t*, size_t);
} icm20948_interface_t;

#endif // ICM20948_ICM20948_CONFIG_H